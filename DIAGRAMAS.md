# ğŸ›ï¸ DIAGRAMA ARQUITECTÃ“NICO - Sistema Completo

## Flujo General de Datos

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      USUARIO (Interfaz Streamlit)                   â”‚
â”‚                           (index.py)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ â”‚  INTERACCIONES DEL USUARIO                â”‚
             â”‚ â”‚ â€¢ Grabar audio                            â”‚
             â”‚ â”‚ â€¢ Cargar archivo                          â”‚
             â”‚ â”‚ â€¢ Transcribir                             â”‚
             â”‚ â”‚ â€¢ Crear oportunidades                     â”‚
             â”‚ â”‚ â€¢ Chat con IA                             â”‚
             â”‚ â”‚ â€¢ Eliminar grabaciÃ³n                      â”‚
             â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SERVICIOS (backend/services/)                    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ AudioService     â”‚ â”‚ Transcription    â”‚ â”‚ OpportunityService
â”‚  â”‚                  â”‚ â”‚ Service          â”‚ â”‚                  â”‚   â”‚
â”‚  â”‚ â€¢ save_rec()     â”‚ â”‚                  â”‚ â”‚ â€¢ create_opp()   â”‚   â”‚
â”‚  â”‚ â€¢ get_all()      â”‚ â”‚ â€¢ save_trans()   â”‚ â”‚ â€¢ get_by_rec()   â”‚   â”‚
â”‚  â”‚ â€¢ delete()       â”‚ â”‚ â€¢ get_trans()    â”‚ â”‚ â€¢ extract_from_kwâ”‚   â”‚
â”‚  â”‚                  â”‚ â”‚ â€¢ update_trans() â”‚ â”‚                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                    â”‚                    â”‚              â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                REPOSITORIES (backend/database/)                     â”‚
â”‚              (Acceso encapsulado a datos)                          â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Recording        â”‚ â”‚ Transcription    â”‚ â”‚ Opportunity      â”‚   â”‚
â”‚  â”‚ Repository       â”‚ â”‚ Repository       â”‚ â”‚ Repository       â”‚   â”‚
â”‚  â”‚                  â”‚ â”‚                  â”‚ â”‚                  â”‚   â”‚
â”‚  â”‚ â€¢ create()       â”‚ â”‚ â€¢ create()       â”‚ â”‚ â€¢ create()       â”‚   â”‚
â”‚  â”‚ â€¢ get_all()      â”‚ â”‚ â€¢ get_by_rec()   â”‚ â”‚ â€¢ get_by_rec()   â”‚   â”‚
â”‚  â”‚ â€¢ get_by_id()    â”‚ â”‚ â€¢ delete_by_rec()â”‚ â”‚ â€¢ get_all()      â”‚   â”‚
â”‚  â”‚ â€¢ get_by_fname() â”‚ â”‚                  â”‚ â”‚ â€¢ delete_by_rec()â”‚   â”‚
â”‚  â”‚ â€¢ delete()       â”‚ â”‚                  â”‚ â”‚                  â”‚   â”‚
â”‚  â”‚ â€¢ update_trans() â”‚ â”‚                  â”‚ â”‚                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                    â”‚                    â”‚              â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         VALIDADORES & ESQUEMAS (backend/)                          â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Validators:      â”‚          â”‚ Schemas:         â”‚               â”‚
â”‚  â”‚                  â”‚          â”‚                  â”‚               â”‚
â”‚  â”‚ â€¢ validate_rec() â”‚          â”‚ â€¢ Recording      â”‚               â”‚
â”‚  â”‚ â€¢ validate_trans()           â”‚ â€¢ Transcription  â”‚               â”‚
â”‚  â”‚ â€¢ validate_opp() â”‚          â”‚ â€¢ Opportunity    â”‚               â”‚
â”‚  â”‚                  â”‚          â”‚                  â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚           â”‚                            â”‚                           â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                        â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CLIENTE SUPABASE (backend/supabase_client.py)          â”‚
â”‚                      (Cliente Singleton)                            â”‚
â”‚                                                                      â”‚
â”‚  â€¢ Una sola conexiÃ³n compartida                                    â”‚
â”‚  â€¢ CachÃ© con Streamlit (@st.cache_resource)                       â”‚
â”‚  â€¢ ConexiÃ³n verificada antes de usar                              â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  CONFIGURACIÃ“N (backend/config.py)                 â”‚
â”‚                                                                      â”‚
â”‚  â€¢ Variables de entorno (.env)                                     â”‚
â”‚  â€¢ Credenciales de Supabase                                        â”‚
â”‚  â€¢ Credenciales de APIs (Gemini, OpenAI)                          â”‚
â”‚  â€¢ Directorios y configuraciones globales                          â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BASE DE DATOS SUPABASE (PostgreSQL)                    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ recordings       â”‚ â”‚ transcriptions   â”‚ â”‚ opportunities    â”‚   â”‚
â”‚  â”‚ (tabla)          â”‚ â”‚ (tabla)          â”‚ â”‚ (tabla)          â”‚   â”‚
â”‚  â”‚                  â”‚ â”‚                  â”‚ â”‚                  â”‚   â”‚
â”‚  â”‚ â€¢ id (PK)        â”‚ â”‚ â€¢ id (PK)        â”‚ â”‚ â€¢ id (PK)        â”‚   â”‚
â”‚  â”‚ â€¢ filename       â”‚ â”‚ â€¢ recording_id   â”‚ â”‚ â€¢ recording_id   â”‚   â”‚
â”‚  â”‚ â€¢ filepath       â”‚ â”‚   (FK)           â”‚ â”‚   (FK)           â”‚   â”‚
â”‚  â”‚ â€¢ transcription  â”‚ â”‚ â€¢ content        â”‚ â”‚ â€¢ title          â”‚   â”‚
â”‚  â”‚ â€¢ created_at     â”‚ â”‚ â€¢ language       â”‚ â”‚ â€¢ description    â”‚   â”‚
â”‚  â”‚                  â”‚ â”‚ â€¢ created_at     â”‚ â”‚ â€¢ created_at     â”‚   â”‚
â”‚  â”‚                  â”‚ â”‚ â€¢ updated_at     â”‚ â”‚                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                    â”‚                    â”‚              â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                 â–¼                                   â”‚
â”‚                    (Integridad referencial)                         â”‚
â”‚                    Relaciones: 1:1, N:1                            â”‚
â”‚                    Cascada al eliminar                             â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo EspecÃ­fico: Guardar GrabaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario hace clic        â”‚
â”‚ "Grabar" en Streamlit    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ index.py                                             â”‚
â”‚                                                      â”‚
â”‚ audio_service.save_recording(filename, filepath)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AudioService.save_recording()                        â”‚
â”‚                                                      â”‚
â”‚ â€¢ Prepara datos                                     â”‚
â”‚ â€¢ Llama a repository.create()                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RecordingRepository.create()                         â”‚
â”‚                                                      â”‚
â”‚ â€¢ Valida datos: DataValidator.validate_recording() â”‚
â”‚ â€¢ IF valida OK: continÃºa                           â”‚
â”‚ â€¢ IF validaciÃ³n falla: lanza excepciÃ³n             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼ (Si validaciÃ³n OK)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SupabaseClient.get_db()                             â”‚
â”‚                                                      â”‚
â”‚ â€¢ Retorna cliente singleton                         â”‚
â”‚ â€¢ Reutiliza conexiÃ³n anterior si existe             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase (PostgreSQL)                               â”‚
â”‚                                                      â”‚
â”‚ INSERT INTO recordings                              â”‚
â”‚ (filename, filepath, created_at)                    â”‚
â”‚ VALUES (...)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Resultado                                            â”‚
â”‚                                                      â”‚
â”‚ Retorna:                                            â”‚
â”‚ â”œâ”€ recording_id (int) si Ã©xito                     â”‚
â”‚ â””â”€ None si fallo                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ index.py (continÃºa)                                 â”‚
â”‚                                                      â”‚
â”‚ if recording_id:                                   â”‚
â”‚     show_success(f"Guardado: {filename}")           â”‚
â”‚ else:                                               â”‚
â”‚     show_error("Error al guardar")                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo EspecÃ­fico: Eliminar GrabaciÃ³n (Con Cascada)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario hace clic            â”‚
â”‚ "Eliminar grabaciÃ³n"         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ index.py                                             â”‚
â”‚                                                      â”‚
â”‚ audio_service.delete_recording(recording_id)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AudioService.delete_recording()                      â”‚
â”‚                                                      â”‚
â”‚ â€¢ Llama a repository.delete(recording_id)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RecordingRepository.delete()                         â”‚
â”‚                                                      â”‚
â”‚ PASOS (En orden, para integridad):                  â”‚
â”‚                                                      â”‚
â”‚ 1. TranscriptionRepository.delete_by_recording()    â”‚
â”‚    â””â”€ Elimina todas las transcripciones             â”‚
â”‚                                                      â”‚
â”‚ 2. OpportunityRepository.delete_by_recording()      â”‚
â”‚    â””â”€ Elimina todas las oportunidades               â”‚
â”‚                                                      â”‚
â”‚ 3. RecordingRepository.delete()                     â”‚
â”‚    â””â”€ Finalmente elimina el recording               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase                                             â”‚
â”‚                                                      â”‚
â”‚ DELETE FROM transcriptions                          â”‚
â”‚ WHERE recording_id = X                              â”‚
â”‚                                                      â”‚
â”‚ DELETE FROM opportunities                           â”‚
â”‚ WHERE recording_id = X                              â”‚
â”‚                                                      â”‚
â”‚ DELETE FROM recordings                              â”‚
â”‚ WHERE id = X                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Resultado: True (Ã©xito) o False (fallo)             â”‚
â”‚                                                      â”‚
â”‚ index.py muestra:                                   â”‚
â”‚ âœ“ GrabaciÃ³n eliminada                              â”‚
â”‚ (TambiÃ©n se eliminaron transcripciones y opps)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Layers & Responsabilidades

```
LAYER 1: PRESENTACIÃ“N
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ index.py (Frontend - Streamlit)          â”‚
â”‚ â€¢ Componentes UI                        â”‚
â”‚ â€¢ InteracciÃ³n del usuario               â”‚
â”‚ â€¢ Renderizado de datos                  â”‚
â”‚ â€¢ Llamadas a servicios                  â”‚
â”‚ â€¢ Manejo de errores/notificaciones      â”‚
â”‚                                         â”‚
â”‚ âŒ NO HACER aquÃ­:                       â”‚
â”‚    - Acceso directo a BD                â”‚
â”‚    - Validaciones de negocio            â”‚
â”‚    - LÃ³gica compleja                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LAYER 2: LÃ“GICA DE NEGOCIO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ backend/services/                       â”‚
â”‚ â€¢ OrchestraciÃ³n de operaciones          â”‚
â”‚ â€¢ Validaciones de reglas de negocio     â”‚
â”‚ â€¢ CoordinaciÃ³n entre repositories       â”‚
â”‚ â€¢ Manejo de excepciones del dominio     â”‚
â”‚                                         â”‚
â”‚ âœ… AQUÃ:                                â”‚
â”‚    - Usar repositories                  â”‚
â”‚    - Aplicar lÃ³gica de negocio          â”‚
â”‚    - Validar integridad de datos        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LAYER 3: ACCESO A DATOS (Repository Pattern)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ backend/database/repositories.py        â”‚
â”‚ â€¢ Operaciones CRUD encapsuladas         â”‚
â”‚ â€¢ Queries a BD                          â”‚
â”‚ â€¢ TransformaciÃ³n de datos               â”‚
â”‚ â€¢ Validaciones de estructura            â”‚
â”‚                                         â”‚
â”‚ âœ… AQUÃ:                                â”‚
â”‚    - AbstracciÃ³n de BD                  â”‚
â”‚    - Una forma Ãºnica de acceder a datos â”‚
â”‚    - Reutilizable                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LAYER 4: INFRAESTRUCTURA
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ backend/supabase_client.py              â”‚
â”‚ â€¢ ConexiÃ³n a BD (Singleton)             â”‚
â”‚ â€¢ ConfiguraciÃ³n de cliente              â”‚
â”‚ â€¢ Pool de conexiones                    â”‚
â”‚                                         â”‚
â”‚ âœ… AQUÃ:                                â”‚
â”‚    - Una sola responsabilidad           â”‚
â”‚    - Una sola conexiÃ³n compartida       â”‚
â”‚    - ReutilizaciÃ³n automÃ¡tica           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LAYER 5: CONFIGURACIÃ“N
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ backend/config.py + .env                â”‚
â”‚ â€¢ Variables de entorno                  â”‚
â”‚ â€¢ Credenciales                          â”‚
â”‚ â€¢ Configuraciones globales              â”‚
â”‚                                         â”‚
â”‚ âœ… AQUÃ:                                â”‚
â”‚    - CentralizaciÃ³n de config           â”‚
â”‚    - Seguridad (no hardcoded)           â”‚
â”‚    - FÃ¡cil de cambiar por entorno       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LAYER 6: BASES DE DATOS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase (PostgreSQL)                   â”‚
â”‚ â€¢ recordings, transcriptions, opportunities â”‚
â”‚ â€¢ Integridad referencial                â”‚
â”‚ â€¢ Ãndices y constraints                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Patrones de DiseÃ±o Implementados

```
1. SINGLETON PATTERN (SupabaseClient)
   â”œâ”€ Una sola instancia
   â”œâ”€ Acceso global
   â””â”€ ReutilizaciÃ³n automÃ¡tica

2. REPOSITORY PATTERN (Repositories)
   â”œâ”€ EncapsulaciÃ³n de BD
   â”œâ”€ AbstracciÃ³n de queries
   â””â”€ FÃ¡cil de testear y reemplazar

3. SERVICE LAYER PATTERN (Services)
   â”œâ”€ LÃ³gica de negocio centralizada
   â”œâ”€ OrquestaciÃ³n de repositories
   â””â”€ Reutilizable en diferentes UIs

4. DEPENDENCY INJECTION (ImplÃ­cito)
   â”œâ”€ Services crean sus propios repos
   â”œâ”€ Repos crean su propio cliente
   â””â”€ FÃ¡cil de mock en tests

5. VALIDATION LAYER (Validators)
   â”œâ”€ ValidaciÃ³n antes de persistir
   â”œâ”€ Reglas centralizadas
   â””â”€ Reutilizable

6. CONFIGURATION MANAGEMENT (Config)
   â”œâ”€ Variables centralizadas
   â”œâ”€ FÃ¡cil de cambiar por entorno
   â””â”€ Seguro (no hardcoded)
```

---

## Matriz de Dependencias

```
index.py
â”œâ”€ AudioService
â”‚  â”œâ”€ RecordingRepository
â”‚  â”‚  â”œâ”€ SupabaseClient.get_db()
â”‚  â”‚  â”‚  â””â”€ Config (credenciales)
â”‚  â”‚  â””â”€ DataValidator
â”‚  â””â”€ TranscriptionRepository (para cascada)
â”‚
â”œâ”€ TranscriptionService
â”‚  â”œâ”€ TranscriptionRepository
â”‚  â”‚  â””â”€ SupabaseClient.get_db()
â”‚  â””â”€ RecordingRepository
â”‚
â”œâ”€ OpportunityService
â”‚  â”œâ”€ OpportunityRepository
â”‚  â”‚  â””â”€ SupabaseClient.get_db()
â”‚  â””â”€ RecordingRepository
â”‚
â”œâ”€ Model (Gemini) - sin cambios
â”œâ”€ AudioRecorder - sin cambios
â”œâ”€ Transcriber - sin cambios
â””â”€ NotificationsUI
   â””â”€ Streamlit (st.markdown)
```

---

## Mapa Mental: QuÃ© Va DÃ³nde

```
USUARIO QUIERE HACER              â†’  DÃ“NDE SUCEDE

Grabar audio                      â†’  index.py + AudioRecorder.py
Guardar en BD                     â†’  AudioService â†’ RecordingRepo â†’ Supabase
Transcribir                       â†’  index.py + Transcriber.py
Guardar transcripciÃ³n              â†’  TranscriptionService â†’ TranscriptionRepo â†’ Supabase
Crear oportunidades               â†’  OpportunityService â†’ OpportunityRepo â†’ Supabase
Eliminar grabaciÃ³n (+ cascada)    â†’  AudioService â†’ RecordingRepository (cascade)
Ver notificaciÃ³n                  â†’  UI Notifications (show_success/error)
Chat con IA                       â†’  index.py + Model.py
Validar datos                     â†’  DataValidator (automÃ¡tico en repositories)
Acceder a config                  â†’  backend/config.py (Config.*)
```

---

**Diagrama actualizado**: 2026-02-06
