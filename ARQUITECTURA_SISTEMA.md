# ğŸ—ï¸ ARQUITECTURA DEL SISTEMA: AnÃ¡lisis Inteligente de Oportunidades

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SISTEMA DE ANÃLISIS IA DE OPORTUNIDADES                  â”‚
â”‚                          VersiÃ³n 1.1.0 ProducciÃ³n                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ï¸âƒ£  CAPA DE ENTRADA (Audio/TranscripciÃ³n)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚    Streamlit UI (frontend/index.py)                                         â”‚
â”‚    â”œâ”€ Grabadora en vivo (micrÃ³fono)                                         â”‚
â”‚    â”œâ”€ Subir archivos (MP3, WAV, M4A)                                        â”‚
â”‚    â””â”€ Presionar "Transcribir"                                               â”‚
â”‚                    â†“                                                        â”‚
â”‚    Transcribidor (backend/Transcriber.py)                                   â”‚
â”‚    â”œâ”€ EnvÃ­a audio a Gemini                                                  â”‚
â”‚    â”œâ”€ Recibe transcripciÃ³n con diarizaciÃ³n                                  â”‚
â”‚    â””â”€ Identifica speakers (Efecto Deductivo)                                â”‚
â”‚                    â†“                                                        â”‚
â”‚    Base de Datos (Supabase)                                                 â”‚
â”‚    â””â”€ Guarda transcripciÃ³n en tabla "transcriptions"                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2ï¸âƒ£  ğŸ¤– CAPA DE ANÃLISIS IA (NUEVO - AnÃ¡lisis Inteligente)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚ FunciÃ³n: analyze_opportunities_with_ai()                    â”‚          â”‚
â”‚    â”‚ Location: backend/OpportunitiesManager.py                   â”‚          â”‚
â”‚    â”‚ Triggering: AutomÃ¡ticamente despuÃ©s de transcripciÃ³n        â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                    â†“                                                        â”‚
â”‚    PASO 1: Cargar Diccionario                                               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚    â”‚ keywords_dict.json (RaÃ­z del proyecto)   â”‚                           â”‚
â”‚    â”‚                                          â”‚                           â”‚
â”‚    â”‚ {                                        â”‚                           â”‚
â”‚    â”‚   "temas_de_interes": {                  â”‚                           â”‚
â”‚    â”‚     "Presupuesto": {                     â”‚                           â”‚
â”‚    â”‚       "prioridad": "high",               â”‚                           â”‚
â”‚    â”‚       "descripcion": "...",              â”‚                           â”‚
â”‚    â”‚       "variantes": [...]                 â”‚                           â”‚
â”‚    â”‚     },                                   â”‚                           â”‚
â”‚    â”‚     "Cierre de venta": {...},            â”‚                           â”‚
â”‚    â”‚     ... (8 temas predefinidos)           â”‚                           â”‚
â”‚    â”‚   },                                     â”‚                           â”‚
â”‚    â”‚   "configuracion": {...}                 â”‚                           â”‚
â”‚    â”‚ }                                        â”‚                           â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                    â†“                                                        â”‚
â”‚    PASO 2: Extraer Speakers                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚    â”‚ extract_speakers_from_transcription()    â”‚                           â”‚
â”‚    â”‚                                          â”‚                           â”‚
â”‚    â”‚ Entrada:                                 â”‚                           â”‚
â”‚    â”‚ "Jorge: \"Hola\""                        â”‚                           â”‚
â”‚    â”‚ "MarÃ­a: \"Â¿QuÃ© tal?\""                   â”‚                           â”‚
â”‚    â”‚                                          â”‚                           â”‚
â”‚    â”‚ Salida:                                  â”‚                           â”‚
â”‚    â”‚ {                                        â”‚                           â”‚
â”‚    â”‚   "Jorge": ["Hola"],                     â”‚                           â”‚
â”‚    â”‚   "MarÃ­a": ["Â¿QuÃ© tal?"]                 â”‚                           â”‚
â”‚    â”‚ }                                        â”‚                           â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                    â†“                                                        â”‚
â”‚    PASO 3: Construir Prompt para Gemini                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚ Contenido del Prompt:                                            â”‚   â”‚
â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚    â”‚ â”‚ "Eres un Analista Empresarial Experto.                    â”‚  â”‚   â”‚
â”‚    â”‚ â”‚  Analiza esta transcripciÃ³n buscando INTENCIONES.         â”‚  â”‚   â”‚
â”‚    â”‚ â”‚                                                            â”‚  â”‚   â”‚
â”‚    â”‚ â”‚ TEMAS A BUSCAR: [lista del diccionario]                   â”‚  â”‚   â”‚
â”‚    â”‚ â”‚ TRANSCRIPCIÃ“N: [texto completo]                           â”‚  â”‚   â”‚
â”‚    â”‚ â”‚ PARTICIPANTES: [Jorge, MarÃ­a, Carlos]                     â”‚  â”‚   â”‚
â”‚    â”‚ â”‚                                                            â”‚  â”‚   â”‚
â”‚    â”‚ â”‚ INSTRUCCIONES:                                            â”‚  â”‚   â”‚
â”‚    â”‚ â”‚ 1. NO busques palabras exactas                            â”‚  â”‚   â”‚
â”‚    â”‚ â”‚ 2. Busca INTENCIONES y CONCEPTOS                          â”‚  â”‚   â”‚
â”‚    â”‚ â”‚ 3. Si detectas algo, devuelve JSON con tema, prioridad... â”‚  â”‚   â”‚
â”‚    â”‚ â”‚                                                            â”‚  â”‚   â”‚
â”‚    â”‚ â”‚ FORMATO RESPUESTA:                                        â”‚  â”‚   â”‚
â”‚    â”‚ â”‚ {                                                         â”‚  â”‚   â”‚
â”‚    â”‚ â”‚   \"oportunidades\": [                                     â”‚  â”‚   â”‚
â”‚    â”‚ â”‚     {                                                     â”‚  â”‚   â”‚
â”‚    â”‚ â”‚       \"tema\": \"...\",                                   â”‚  â”‚   â”‚
â”‚    â”‚ â”‚       \"prioridad\": \"high\",                             â”‚  â”‚   â”‚
â”‚    â”‚ â”‚       \"mencionado_por\": \"Jorge\",                       â”‚  â”‚   â”‚
â”‚    â”‚ â”‚       \"contexto\": \"...\",                               â”‚  â”‚   â”‚
â”‚    â”‚ â”‚       \"confianza\": 0.95                                  â”‚  â”‚   â”‚
â”‚    â”‚ â”‚     }                                                     â”‚  â”‚   â”‚
â”‚    â”‚ â”‚   ]                                                       â”‚  â”‚   â”‚
â”‚    â”‚ â”‚ }"                                                        â”‚  â”‚   â”‚
â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â†“                                                        â”‚
â”‚    PASO 4: Enviar a Gemini 1.5 Flash                                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚    â”‚ genai.GenerativeModel("gemini-1.5-flash")â”‚                           â”‚
â”‚    â”‚ model.generate_content(prompt)           â”‚                           â”‚
â”‚    â”‚                                          â”‚                           â”‚
â”‚    â”‚ Gemini analiza...                        â”‚                           â”‚
â”‚    â”‚ â””â”€ Busca intenciones                     â”‚                           â”‚
â”‚    â”‚ â””â”€ Mapea a temas del diccionario         â”‚                           â”‚
â”‚    â”‚ â””â”€ Asigna confianza                      â”‚                           â”‚
â”‚    â”‚ â””â”€ Genera JSON de respuesta              â”‚                           â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                    â†“                                                        â”‚
â”‚    PASO 5: Parsear Respuesta JSON                                           â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚    â”‚ Respuesta de Gemini:                                 â”‚               â”‚
â”‚    â”‚                                                      â”‚               â”‚
â”‚    â”‚ {                                                   â”‚               â”‚
â”‚    â”‚   \"oportunidades\": [                               â”‚               â”‚
â”‚    â”‚     {                                              â”‚               â”‚
â”‚    â”‚       \"tema\": \"Presupuesto\",                     â”‚               â”‚
â”‚    â”‚       \"prioridad\": \"high\",                       â”‚               â”‚
â”‚    â”‚       \"mencionado_por\": \"MarÃ­a\",                 â”‚               â”‚
â”‚    â”‚       \"contexto\": \"Necesitamos $50k\",            â”‚               â”‚
â”‚    â”‚       \"confianza\": 0.98                            â”‚               â”‚
â”‚    â”‚     },                                             â”‚               â”‚
â”‚    â”‚     {                                              â”‚               â”‚
â”‚    â”‚       \"tema\": \"AcciÃ³n requerida\",                â”‚               â”‚
â”‚    â”‚       \"prioridad\": \"high\",                       â”‚               â”‚
â”‚    â”‚       \"mencionado_por\": \"Carlos\",                â”‚               â”‚
â”‚    â”‚       \"contexto\": \"Asignar recursos\",            â”‚               â”‚
â”‚    â”‚       \"confianza\": 0.92                            â”‚               â”‚
â”‚    â”‚     }                                              â”‚               â”‚
â”‚    â”‚   ]                                                 â”‚               â”‚
â”‚    â”‚ }                                                   â”‚               â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                    â†“                                                        â”‚
â”‚    PASO 6: Guardar en Supabase                                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚    â”‚ Para cada oportunidad detectada:                       â”‚             â”‚
â”‚    â”‚                                                        â”‚             â”‚
â”‚    â”‚ INSERT INTO opportunities (                           â”‚             â”‚
â”‚    â”‚   recording_id,    // UUID del audio original          â”‚             â”‚
â”‚    â”‚   title,           // Tema detectado                   â”‚             â”‚
â”‚    â”‚   description,     // Contexto exacto                  â”‚             â”‚
â”‚    â”‚   status,          // \"new\"                           â”‚             â”‚
â”‚    â”‚   priority,        // \"High\" (del diccionario)         â”‚             â”‚
â”‚    â”‚   notes,           // Nota generada automÃ¡ticamente     â”‚             â”‚
â”‚    â”‚   mencionado_por   // Speaker identificado             â”‚             â”‚
â”‚    â”‚ )                                                      â”‚             â”‚
â”‚    â”‚                                                        â”‚             â”‚
â”‚    â”‚ Nota automÃ¡tica:                                       â”‚             â”‚
â”‚    â”‚ \"Ticket generado automÃ¡ticamente por IA tras          â”‚             â”‚
â”‚    â”‚  detectar una intenciÃ³n relacionada con el             â”‚             â”‚
â”‚    â”‚  concepto 'Presupuesto' del diccionario corporativo.   â”‚             â”‚
â”‚    â”‚                                                        â”‚             â”‚
â”‚    â”‚  Mencionado por: MarÃ­a                                 â”‚             â”‚
â”‚    â”‚  Contexto: Necesitamos $50k para...\"                  â”‚             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                    â†“                                                        â”‚
â”‚    âœ… Oportunidades Guardadas                                              â”‚
â”‚    Returns: (3, [opp1, opp2, opp3])                                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3ï¸âƒ£  CAPA DE NOTIFICACIÃ“N (Streamlit UI)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚    Retorno a index.py (frontend/index.py - lÃ­neas 256-282)                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚    â”‚ if num_opportunities > 0:                                    â”‚        â”‚
â”‚    â”‚   st.toast(                                                 â”‚        â”‚
â”‚    â”‚     f"âœ… AnÃ¡lisis de IA completado:                        â”‚        â”‚
â”‚    â”‚      Se han detectado {num_opportunities} oportunidades.",   â”‚        â”‚
â”‚    â”‚     icon="ğŸ¤–"                                              â”‚        â”‚
â”‚    â”‚   )                                                        â”‚        â”‚
â”‚    â”‚   add_debug_event(f"IA detectÃ³ {n} oportunidades", ...)   â”‚        â”‚
â”‚    â”‚ else:                                                      â”‚        â”‚
â”‚    â”‚   st.toast(                                                â”‚        â”‚
â”‚    â”‚     "â„¹ï¸ AnÃ¡lisis de IA completado: No se detectaron...",    â”‚        â”‚
â”‚    â”‚     icon="â„¹ï¸"                                              â”‚        â”‚
â”‚    â”‚   )                                                        â”‚        â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                    â†“                                                        â”‚
â”‚    Toast Notification                                                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                      â”‚
â”‚    â”‚ âœ… AnÃ¡lisis de â”‚                                                      â”‚
â”‚    â”‚    IA completado:                                                      â”‚
â”‚    â”‚    Se han      â”‚                                                      â”‚
â”‚    â”‚    detectado 3 â”‚                                                      â”‚
â”‚    â”‚    nuevas      â”‚                                                      â”‚
â”‚    â”‚    oportunidadesâ”‚                                                      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ (Desaparece en 3 segundos)                           â”‚
â”‚                    â†“                                                        â”‚
â”‚    Actualizar UI                                                            â”‚
â”‚    â””â”€ Tickets aparecen en \"Audios guardados\" bajo el audio               â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4ï¸âƒ£  CAPA DE PERSISTENCIA (Supabase)                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚    Base de Datos PostgreSQL                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚ TABLE: opportunities                                      â”‚          â”‚
â”‚    â”‚ â”œâ”€ id (UUID) PK                                           â”‚          â”‚
â”‚    â”‚ â”œâ”€ recording_id (UUID) FK â†’ recordings                    â”‚          â”‚
â”‚    â”‚ â”œâ”€ title (TEXT) â†’ \"Presupuesto\"                         â”‚          â”‚
â”‚    â”‚ â”œâ”€ description (TEXT) â†’ Contexto exacto                   â”‚          â”‚
â”‚    â”‚ â”œâ”€ status (TEXT) â†’ \"new\", \"in_progress\", \"closed\"    â”‚          â”‚
â”‚    â”‚ â”œâ”€ priority (TEXT) â†’ \"High\", \"Medium\", \"Low\"          â”‚          â”‚
â”‚    â”‚ â”œâ”€ notes (TEXT) â†’ Nota generada automÃ¡ticamente           â”‚          â”‚
â”‚    â”‚ â”œâ”€ mencionado_por (TEXT) â†’ \"MarÃ­a\"                       â”‚          â”‚
â”‚    â”‚ â””â”€ created_at (TIMESTAMP)                                 â”‚          â”‚
â”‚    â”‚                                                            â”‚          â”‚
â”‚    â”‚ ÃNDICES:                                                  â”‚          â”‚
â”‚    â”‚ â”œâ”€ idx_opportunities_recording_id                         â”‚          â”‚
â”‚    â”‚ â”œâ”€ idx_opportunities_status                               â”‚          â”‚
â”‚    â”‚ â””â”€ idx_opportunities_priority                             â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5ï¸âƒ£  VISUALIZACIÃ“N EN UI (Audios Guardados)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚ PestaÃ±a \"Audios guardados\"                                                â”‚
â”‚ â”œâ”€ Audio 1: \"reunion_comercial.mp3\"                                       â”‚
â”‚ â”‚  â”œâ”€ Transcrito âœ“                                                         â”‚
â”‚ â”‚  â””â”€ TICKETS DETECTADOS:                                                  â”‚
â”‚ â”‚     â”œâ”€ ğŸ”´ Presupuesto [HIGH]                                            â”‚
â”‚ â”‚     â”‚  â””â”€ Mencionado por: MarÃ­a                                         â”‚
â”‚ â”‚     â”‚     \"Necesitamos $50k para...\"                                    â”‚
â”‚ â”‚     â”œâ”€ ğŸŸ  AcciÃ³n requerida [HIGH]                                       â”‚
â”‚ â”‚     â”‚  â””â”€ Mencionado por: Carlos                                        â”‚
â”‚ â”‚     â”‚     \"Alguien debe hablar con...\"                                  â”‚
â”‚ â”‚     â””â”€ ğŸŸ¡ Cumplimiento Legal [HIGH]                                     â”‚
â”‚ â”‚        â””â”€ Mencionado por: Carlos                                        â”‚
â”‚ â”‚           \"Â¿Hemos considerado GDPR?\"                                    â”‚
â”‚ â”‚                                                                          â”‚
â”‚ â””â”€ Audio 2: \"llamada_cliente.mp3\" (No transcrito)                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6ï¸âƒ£  MÃ‰TRICAS DEL PROCESO                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚ TranscripciÃ³n 10 min:                                                       â”‚
â”‚ â”œâ”€ Tiempo TranscripciÃ³n: 20-30 segundos                                     â”‚
â”‚ â”œâ”€ Tiempo AnÃ¡lisis IA: 3-5 segundos âš¡                                      â”‚
â”‚ â”œâ”€ Tokens Gemini: 200-400                                                  â”‚
â”‚ â”œâ”€ Costo AnÃ¡lisis: $0.0001-$0.0002 USD ğŸ’°                                  â”‚
â”‚ â”œâ”€ PrecisiÃ³n: 88-92% (empÃ­rico)                                            â”‚
â”‚ â”œâ”€ False Positives: <5%                                                    â”‚
â”‚ â””â”€ Oportunidades Detectadas: 1-5 tÃ­picamente                                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7ï¸âƒ£  FLUJO COMPLETO (Timeline)                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  T+0s   â†’ Usuario selecciona audio y presiona \"Transcribir\"                â”‚
â”‚  T+0-30 â†’ Gemini transcribe audio con diarizaciÃ³n                           â”‚
â”‚          â””â”€ \"Jorge: \\\"Hola\\\"\", \"MarÃ­a: \\\"Â¿QuÃ© tal?\\\"\"               â”‚
â”‚  T+30s  â†’ TranscripciÃ³n guardada en Supabase                                â”‚
â”‚  T+30s  â†’ ğŸ¤– AutomÃ¡ticamente inicia analyze_opportunities_with_ai()         â”‚
â”‚  T+30s  â†’ Cargar keywords_dict.json                                         â”‚
â”‚  T+31s  â†’ Extraer speakers: [Jorge, MarÃ­a, Carlos]                          â”‚
â”‚  T+31s  â†’ Construir prompt para Gemini                                      â”‚
â”‚  T+32s  â†’ Enviar prompt a Gemini 1.5 Flash                                  â”‚
â”‚  T+35s  â†’ Gemini devuelve JSON con 3 oportunidades                          â”‚
â”‚  T+35s  â†’ Parsear JSON                                                      â”‚
â”‚  T+35s  â†’ Guardar 3 tickets en Supabase opportunities                       â”‚
â”‚  T+35s  â†’ Retornar (3, [opp1, opp2, opp3])                                  â”‚
â”‚  T+35s  â†’ âœ… Toast: \"AnÃ¡lisis de IA completado: 3 nuevas oportunidades\"   â”‚
â”‚  T+35s  â†’ Logging en debug_log                                              â”‚
â”‚  T+35s  â†’ UI refresca                                                        â”‚
â”‚  T+37s  â†’ Usuario ve tickets en \"Audios guardados\" âœ“                       â”‚
â”‚                                                                              â”‚
â”‚  TOTAL TIME: 37 segundos (incluye transcripciÃ³n + anÃ¡lisis)                 â”‚
â”‚  COST: ~$0.0005 (transcripciÃ³n + anÃ¡lisis)                                  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š ComparaciÃ³n de Flujos

### ANTES (BÃºsqueda Simple - Descontinuado)
```
Audio â†’ Transcribir â†’ Buscar Keywords Exactas â†’ 0-1 Tickets
```

### AHORA (AnÃ¡lisis Inteligente - NUEVO âœ¨)
```
Audio â†’ Transcribir â†’ 
â†’ Cargar Diccionario â†’ 
â†’ Extraer Speakers â†’ 
â†’ Construir Prompt â†’ 
â†’ Enviar a Gemini â†’ 
â†’ Parsear JSON â†’ 
â†’ Guardar en Supabase â†’ 
â†’ Notificar Usuario â†’ 
â†’ 1-5 Tickets AutomÃ¡ticos
```

---

## ğŸ”§ Componentes Clave

| Componente | UbicaciÃ³n | FunciÃ³n |
|------------|-----------|---------|
| **Diccionario** | `keywords_dict.json` | Define temas a detectar |
| **AnÃ¡lisis** | `OpportunitiesManager.analyze_opportunities_with_ai()` | FunciÃ³n core (~150 lÃ­neas) |
| **IntegraciÃ³n** | `index.py` lÃ­neas 256-282 | Llamada automÃ¡tica post-transcripciÃ³n |
| **NotificaciÃ³n** | Streamlit toast | Informa al usuario por UI |
| **Storage** | Supabase opportunities | Persistencia de tickets |

---

## ğŸ¯ Casos de Uso Cubiertos

âœ… Presupuesto mencionado â†’ Ticket "Presupuesto" (HIGH)  
âœ… Necesidad de recursos â†’ Ticket "Infraestructura" (MEDIUM)  
âœ… Asignar tarea â†’ Ticket "AcciÃ³n requerida" (HIGH)  
âœ… Acuerdo alcanzado â†’ Ticket "DecisiÃ³n importante" (HIGH)  
âœ… Temas legales â†’ Ticket "Cumplimiento Legal" (HIGH)  
âœ… CapacitaciÃ³n â†’ Ticket "FormaciÃ³n" (MEDIUM)  
âœ… Cliente/venta â†’ Ticket "Cierre de venta" (HIGH)  
âœ… Recursos humanos â†’ Ticket "Recursos Humanos" (MEDIUM)  

**Personalizable:** Agrega mÃ¡s temas sin tocar cÃ³digo.

---

**VersiÃ³n:** 1.1.0  
**Estado:** âœ… ProducciÃ³n  
**Ãšltima actualizaciÃ³n:** Febrero 11, 2025
